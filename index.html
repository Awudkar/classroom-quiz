<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Mock Quiz</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body { padding:20px; }
.hidden { display:none; }
.timer { font-size:20px; font-weight:bold; color:red; }
    {
    /* user-select: none; */
    -webkit-user-select: none;
    -ms-user-select: none;
    }
</style>
</head>
<body>
<div class="container">

<h2 class="text-center mb-4">Mock Quiz -- Designed By Dr. Awudu Karim</h2>

<!-- Load Quiz Button -->
<div id="lecturerPanel" class="card p-3 mb-3">
<h4>Load Quiz</h4>
<button type="button" class="btn btn-success" onclick="startQuiz()">Start Quiz</button>
</div>

<!-- Student Info -->
<div id="studentInfo" class="card p-3 mb-3 hidden">
<h4>Student Information</h4>
<input type="text" id="studentId" placeholder="Student ID" class="form-control mb-2" required>
<input type="text" id="studentName" placeholder="Full Name" class="form-control mb-2" required>
<input type="text" id="courseInput" placeholder="Course" class="form-control mb-2" required>
<label>Time (minutes)</label>
<input type="number" id="quizTime" class="form-control mb-2" value="10">
<button type="button" class="btn btn-success" onclick="startQuiz()">Start Quiz</button>
</div>

<!-- Quiz Section -->
<div id="quizSection" class="hidden">
<div class="timer mb-3">Time Left: <span id="timeLeft"></span></div>
<div id="quizForm"></div>
<button type="button" class="btn btn-success mt-3" onclick="submitQuiz(
  document.getElementById('studentId').value,
  document.getElementById('studentName').value,
  document.getElementById('course').value
)">Submit Quiz</button>
</div>

<!-- Result Section -->
<div id="resultSection" class="hidden"></div>

<button type="button" class="btn btn-secondary mt-3 hidden" id="downloadBtn" onclick="downloadCSV()">Download Results CSV</button>

</div>

<script>
console.log("Script Loaded");

let questions = [];
let currentQuestionIndex = 0;
let score = 0;
let timer;
let timePerQuestion = 30;
let timeRemaining;
let quizLocked = false;

// ---------------- LOAD QUIZ ----------------
function loadQuiz() {
    fetch('quiz.txt')
    .then(response => response.text())
    .then(data => {
        questions = parseQuiz(data);
        document.getElementById("studentInfo").classList.remove("hidden");
        document.getElementById("lecturerPanel").classList.add("hidden");
    })
    .catch(err => alert("Could not load quiz"));
}

// ---------------- PARSE QUIZ ----------------
function parseQuiz(text) {
    const blocks = text.trim().split(/\n\s*\n/);
    let qs = [];

    blocks.forEach(block => {
        const lines = block.split("\n").map(l => l.trim()).filter(l => l !== "");
        if (lines.length !== 5) return;

        const questionText = lines[0].replace(/^Q\d+\.\s*/, "");
        let opts = [];
        let correctText = "";

        lines.slice(1).forEach(line => {
            if (line.includes("*")) {
                correctText = line.replace("*","").trim();
                opts.push(correctText);
            } else {
                opts.push(line.trim());
            }
        });

        opts = shuffleArray(opts);
        const correctIndex = opts.indexOf(correctText);

        qs.push({ question: questionText, options: opts, answer: correctIndex });
    });

    return shuffleArray(qs);
}

// ---------------- START QUIZ ----------------
function startQuiz() {

    enableSecurityMode();

    const id = document.getElementById("studentId").value;
    const name = document.getElementById("studentName").value;
    const course = document.getElementById("course").value;

    if (!id || !name || !course) return alert("Fill all fields");

    document.getElementById("studentInfo").classList.add("hidden");
    document.getElementById("quizSection").classList.remove("hidden");

    currentQuestionIndex = 0;
    score = 0;

    showQuestion();
}

// ---------------- SHOW QUESTION ----------------
function showQuestion() {

    if (currentQuestionIndex >= questions.length) {
        endQuiz();
        return;
    }

    const q = questions[currentQuestionIndex];
    const container = document.getElementById("quizForm");

    container.innerHTML = `
        <div class="card p-3">
        <h5>Question ${currentQuestionIndex + 1} of ${questions.length}</h5>
        <strong>${q.question}</strong><br><br>
        ${q.options.map((opt, i) =>
            `<div>
             <input type="radio" name="option" value="${i}"> ${opt}
             </div>`
        ).join("")}
        </div>
        <button class="btn btn-primary mt-3" onclick="nextQuestion()">Next</button>
    `;

    startTimer();
}

// ---------------- TIMER ----------------
function startTimer() {
    clearInterval(timer);
    timeRemaining = timePerQuestion;
    updateTimerDisplay();

    timer = setInterval(() => {
        timeRemaining--;
        updateTimerDisplay();

        if (timeRemaining <= 0) {
            clearInterval(timer);
            nextQuestion();
        }
    }, 1000);
}

function updateTimerDisplay() {
    document.getElementById("timeLeft").innerText =
        "Time Left: " + timeRemaining + "s";
}

// ---------------- NEXT QUESTION ----------------
function nextQuestion() {

    const selected = document.querySelector('input[name="option"]:checked');
    const selectedIndex = selected ? parseInt(selected.value) : null;

    if (selectedIndex === questions[currentQuestionIndex].answer) {
        score++;
    }

    currentQuestionIndex++;
    showQuestion();
}

// ---------------- END QUIZ ----------------
function endQuiz() {
    clearInterval(timer);

    document.getElementById("quizSection").innerHTML =
        `<h3>Quiz Completed</h3>
         <h4>Your Score: ${score} / ${questions.length}</h4>`;
}

// ---------------- TAB SWITCH DETECTION ----------------
document.addEventListener("visibilitychange", function() {
    if (document.hidden && !quizLocked) {
        quizLocked = true;
        clearInterval(timer);
        document.body.innerHTML =
            "<h2 style='color:red;text-align:center;margin-top:100px;'>Tab Switching Detected. Quiz Locked.</h2>";
    }
});

// ---------------- SECURITY MODE ----------------
function enableSecurityMode() {

    document.addEventListener("contextmenu", e => e.preventDefault());
    document.addEventListener("copy", e => e.preventDefault());
    document.addEventListener("cut", e => e.preventDefault());

    document.addEventListener("keydown", function(e) {

        if (e.ctrlKey && (
            e.key === "c" ||
            e.key === "x" ||
            e.key === "u" ||
            e.key === "s"
        )) {
            e.preventDefault();
        }

        if (e.key === "F12") {
            e.preventDefault();
        }

    });
}

// ---------------- SHUFFLE ----------------
function shuffleArray(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
}
</script>
</body>
</html>





